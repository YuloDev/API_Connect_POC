name: Deploy API to IBM API Connect
 
on:
  workflow_dispatch:
    inputs:
      product_file:
        description: 'Ruta del archivo del producto (ej: product.yaml)'
        required: true
        default: '0-dev/products/product.yaml'
      org_name:
        description: 'Nombre de la organización en IBM API Connect'
        required: true
        default: 'test-0'
      catalog_name:
        description: 'Nombre del catálogo destino (sandbox/test/prod)'
        required: true
        default: 'sandbox'
 
jobs:
  deploy:
    runs-on: ubuntu-latest
    name: Deploy API Product
 
    env:
      APIC_SERVER: ${{ secrets.APIC_SERVER }}
      APIC_APIKEY: ${{ secrets.APIC_APIKEY }}
 
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
 
      - name: Deploy API Product
        uses: ibm-apiconnect/actions@main
        with:
          manager-host: ${{ env.APIC_SERVER }}
          api-host: ${{ env.APIC_SERVER }}
          provider-org: ${{ github.event.inputs.org_name }}
          catalog: ${{ github.event.inputs.catalog_name }}
          apikey: ${{ env.APIC_APIKEY }}
          product-file: ${{ github.event.inputs.product_file }}
          migrate_subscriptions: 'true'
 